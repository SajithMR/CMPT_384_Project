<!DOCTYPE html>
<html>
<head>
    <style src="https://mcaule.github.io/d3-timeseries/dist/d3_timeseries.min.css "></style>
<style>
    	/* tell the SVG path to be a thin blue line without any area fill */
			path {
				stroke: steelblue;
				stroke-width: 1;
				fill: none;
			}

			.axis {
			  shape-rendering: crispEdges;
			}

			.x.axis line {
			  stroke: lightgrey;
			}

			.x.axis .minor {
			  stroke-opacity: .5;
			}

			.x.axis path {
			  display: none;
			}

			.y.axis line, .y.axis path {
			  fill: none;
			  stroke: #000;
			}


#parent1 {
    position: absolute;
    border: 1px solid blue;
    top: 80px;
    left: 1px;
    width: 64%;

}

#child1 {
    position: fixed;
    border: 1px solid #ffffff;
    top: 80px;
    right: 0px;
    width: 35%;
    height: 40%;
}


#parent3 {
    position: fixed;
    border: 1px solid green;
    top: 55%;
    right: 0px;
    width: 17%;
    height: 40%;
}

#parent4 {
    position: fixed;
    border: 1px solid violet;
    top: 55%;
    right: 18%;
    width: 17%;
    height: 40%;
}
 .horizon {
    border-top: solid 2px #17262d;
    border-bottom: solid 2px #17262d;
    overflow: hidden;
    position: relative;
  }

  .horizon + .horizon {
    border-top: none;
  }

  .horizon canvas {
    display: block;
    image-rendering: pixelated;
  }

  .horizon .title,
  .horizon .value {
      bottom: 0;
      line-height: 30px;
      margin: 0 10px;
      position: absolute;
      font-family: sans-serif;
      text-shadow: 0 1px 0 rgba(255,255,255,.5);
      white-space: nowrap;
  }

  .horizon .title {
      left: 0;
  }

  .horizon .value {
      right: 0;
  }
    body {
  background-color: #f0f1ff;
}
    h1 {
   font: italic bold 2.2em Lora;
   color: #BBB;
   margin: 0px;
}

p {
   margin-top: 1.2em;
   margin-bottom: 0.3em;
   font: 1em Muli;
   color: #BBB;
}

controls {
   width:220px;
   position: absolute;
   padding:10px;
}
  #sun {
        stroke: #666;
        fill: #666;
      }

      .orbit {
        stroke: #ccc;
        fill: transparent;
      }

      .planet {
        stroke: #666;
        fill: #fff;
      }

      .moon {
        stroke: #ccc;
        fill: #fff;
      }


</style>
</head>
  <script src="https://d3js.org/d3.v5.js"></script>
  <script src="https://unpkg.com/d3-horizon-chart"></script>
<script src="https://mcaule.github.io/d3-timeseries/dist/d3_timeseries.min.js"></script>
<script src = "https://mcaule.github.io/d3-timeseries/dist/create-example-data.js"></script>


<script src="this.js"></script>
<body>
<h1>Kepler Data</h1>

<div id="parent1"> </div>

<div id="child1"></div>

<div id="parent3"></div>

<div id="parent4">
     <canvas id="content"></canvas>
</div>
</body>

<script>
 var series = [0];

var horizonChart = d3.horizonChart()
    .height(20)
    .colors(['#0046FF  ', '#1051FD  ', '#205DFF  ', '#4275FF  ', '#608BFF  ', '#6C94FF  ', '#81A3FF', '#AEC4FF  ']);


var horizons = d3.select('#parent1').selectAll('.horizon')
    .data(data)    .enter().append('div')
    .attr('class', 'horizon')
    .each(horizonChart)
      .on("click", function(d,i){
          console.log(i);
          series = d;
          updateData(series);



    });





        var w =document.getElementById("parent3").offsetWidth;
        var h = document.getElementById("parent3").offsetHeight;
        var x = (w/2) ;
        var y = (h / 2);
        var t0 = new Date().setHours(0, 0, 0, 0);
        var delta = (Date.now() - t0);

        // planets and moons
        var planets = [

            {
                R: 87,
                r: 2,
                speed: -1.00,
                phi0: 135,
                moons: [ // earth
                    {
                        R: 10,
                        r: 1,
                        speed: -9.00,
                        phi0: 15
                    } // the moon
                ]
            }

        ];

        // insert svg element
        var svg = d3.select('#parent3').insert("svg")
            .attr("width", w)
            .attr("height", h);

        // sun
        svg.append("circle")
            .attr("r", 10)
            .attr("cx", x)
            .attr("cy", y)
            .attr("id", "sun");

        // planet group
        var container = svg.append("g")
            .attr("id", "orbit_container")
            .attr("transform", "translate(" + x + "," + y + ")");

        // draw planets and moon clusters
        container.selectAll("g.planet").data(planets).enter().append("g")
            .attr("class", "planet_cluster").each(function(d, i) {
                d3.select(this).append("circle").attr("class", "orbit")
                    .attr("r", d.R);
                d3.select(this).append("circle").attr("r", d.r).attr("cx", d.R)
                    .attr("cy", 0).attr("class", "planet");
                d3.select(this).append("g").attr("transform", "translate(" + d.R + ",0)")
                    .selectAll("g.moon").data(d.moons).enter().append("g")
                    .attr("class", "moon_cluster").each(function(d, i) {
                        d3.select(this).append("circle").attr("class", "orbit")
                            .attr("r", d.R);
                        d3.select(this).append("circle").attr("r", d.r).attr("cx", d.R)
                            .attr("cy", 0).attr("class", "moon");
                    })
                    .attr("transform", function(d) {
                        return "rotate(" + (d.phi0 + (delta * (d.speed / 100))) + ")";
                    });
            })
            .attr("transform", function(d) {
                return "rotate(" + (d.phi0 + (delta * (d.speed / 100))) + ")";
            });

        // throttled rotaiton animations
        setInterval(function() {
            var delta = (Date.now() - t0);
            svg.selectAll(".planet_cluster, .moon_cluster").attr("transform", function(d) {
                return "rotate(" + (d.phi0 + (delta * (d.speed / 100))) + ")";
            });
        }, 40);


        var context = document.getElementById('content').getContext('2d');

        var width =document.getElementById("parent4").offsetWidth;
        var height = document.getElementById("parent4").offsetHeight;
        var size = d3.min([width, height]);

        d3.select('#content')
            .attr('width', width + 'px')
            .attr('height', height + 'px');


        context.lineWidth = 0.5;
        context.strokeStyle = 'rgba(255, 255, 0, 0.6)';


        var projection = d3.geoOrthographic()
            .scale(0.5 * size)
            .translate([0.5 * width, 0.5 * height]);

        var geoGenerator = d3.geoPath()
            .projection(projection)
            .context(context);

        var geojson = {
            type: 'Feature',
            geometry: {
                type: 'LineString',
                coordinates: []
            }
        };

        function rndLon() {
            return -180 + Math.random() * 360;
        }

        function rndLat() {
            return -90 + Math.random() * 180;
        }

        function addPoint() {
            geojson.geometry.coordinates.push([rndLon(), rndLat()])
        }


        for (i = 0; i < 2000; i++) {
            addPoint()
        }

        function random_rgba(number) {
            var o = Math.round,
                r = Math.random,
                s = 255;
            return 'rgba(' + s * number + ',' + number * s + ',' + 0 + ',' + 0.6 + ')';
        }
        var i = 0;
        function update(t) {
            projection.rotate([t / 50]);

            context.clearRect(0, 0, width, height);
            context.beginPath();
            geoGenerator(geojson);
            context.stroke();

            context.strokeStyle = random_rgba(series[i]);
            if (i == series.length) i = 0;
            i += 1;


            window.requestAnimationFrame(update);
        }



        window.requestAnimationFrame(update);

	/* implementation heavily influenced by http://bl.ocks.org/1166403 */

		// define dimensions of graph
		var m = [80, 80, 80, 80]; // margins
		var w = document.getElementById("child1").offsetWidth - m[1] - m[3]; // width
		var h = document.getElementById("child1").offsetHeight - m[0] - m[2]; // height

		// create a simple data array that we'll plot with a line (this array represents only the Y values, X will just be the index location)
		var data = [0.08904428019772859,0.07951839236410904,0.019070751539417632,-0.02559845156883023,-0.037534275169122465,-0.11832405096919266,-0.1282579200546505,-0.0913403607313301,-0.07579912141711813,-0.1519682723417175,-0.19684621004392913,-0.14694915415049764,-0.16481493780657894,-0.13905519132423125,-0.11410191940947086,-0.09758342267806483,-0.09365541713711016,-0.04594058654420904,-0.08213706272474548,-0.0007969866314980502,-0.024526314790743572,-0.06393920130554001,-0.03467840640625444,-0.08255453191267303,-0.09271611146427318,-0.12485175099860528,-0.12789737848325855,-0.177395941060941,-0.23180925453286144,-0.21419964515119025,-0.21784301260946706,-0.2405002039906259,-0.13827718056491173,-0.13827718056491173,0.028909741263982845,-0.1645113238517225,-0.1779557292902075,-0.18300331128969513,-0.1734015199673615,-0.1859540594134558,-0.19764319667542718,-0.09793447631336755,-0.1839236410903536,-0.1780316327789216,-0.08752621042344659,-0.11314363786445535,-0.0830194407810469,-0.0017647561126028256,-0.004734480108541989,0.01708777289676177,0.010550584931259903,0.0585500536068389,-0.0005787641014450126,0.03984933157490251,-0.02964980027894532,-0.07076102735371974,-0.049280340047629434,-0.0850688349763276,-0.07878782128523583,-0.11203354934201162,-0.1478694839511561,-0.13827718056491173,-0.17842063815858136,-0.2146930178278319,-0.24420049906543828,-0.2840023909598945,-0.3464994259798666,-0.36903327419186505,-0.12130326290122109,-0.12130326290122109,-0.18139985009060977,-0.19333567369090202,-0.24541495488486392,-0.2469994402117707,-0.2392952361072896,-0.2066472480241373,-0.0934941222235927,-0.07294325265425011,-0.06444206191827091,-0.0007210831427839502,0.1201647105705096,0.07689972200347257,0.20243460440050476,0.13942522083171247,0.11749860052942683,0.05944191959922958,0.08359820488249191,0.012429196276933879,-0.004848335341613139,-0.03799918403749632,-0.10462347125629762,-0.15423588906705124,-0.24087023349810716,-0.24087023349810716,-0.1699289353586914,-0.1319771910016414,-0.220841200413674,-0.19436037078854235,-0.12210973746880839,-0.1286848771786673,-0.06034327352770952,-0.016072563735210682,-0.0432175488865907,0.02073114035503857,0.0561970454567018,0.08803855897226677,0.14819207377819102,0.121047088626811,0.11198610966156532,0.18441701376699526,0.0925548165507557,0.05348349573517273,0.07227909712800175,0.0062430619467347265,0.030380371357818535,0.006546675901591127,-0.09650179796388891,-0.09650179796388891,-0.05558032961089974,-0.021252976839948003,-0.032695427763598586,0.06508724157234076,-0.008671973585585928,0.14379915936886248,0.1662665920282361,0.0979724280577246,0.16448286004345475,0.16244295378426332,0.1880698691613613,0.10916819264305436,0.14233801721111608,0.1489605966014213,0.12473789576553412,0.0686167537975464,0.14904598802622465,0.10467091093674392,0.12305853107773465,0.08141597958196153,0.09743161570063663,-0.006679507006840802,0.02263821550898033,-0.008880708179549703,0.010455705570367277,0.005474539123504463,-0.08114082943537292,-0.056605026708540084,-0.09740315189236885,-0.04246800193553896,-0.13912160687685607,-0.09459472280994716,-0.16583963490421927,-0.08743133106255396,-0.13381785060295834,-0.1420249153201704,-0.12148353368691707,-0.17163676385475868,-0.18857272977409223,-0.22202719242483182,-0.2858430505612114,-0.278708122622086,-0.29139349317343,-0.35908042923422867,-0.28588100230556845,-0.3472299970587398,-0.16630454377259316,-0.16630454377259316,-0.17682666489558527,-0.11560101331157434,-0.10334259988424718,-0.08551476797252293,-0.10014516542216571,-0.06800952588783363,-0.04372040949932161,-0.030351907549550743,0.11449092478913062,0.05491617408465137,0.12836228735163238,0.15321119196941088,0.1773010617000484,0.08980331508486959,0.15774642542007836,0.2011821968367221,0.16749053578375095,0.1961725665815915,0.17224399176447147,0.17222501589229294,0.28317694052012865,0.27999848193022575,0.03681319202633851,0.03681319202633851,0.0008064745675873127,0.016442593242691914,0.09838040930956289,0.1348615235727772,0.1314458665806427,0.201504786663757,0.25169596857595566,0.24481721491124034,0.2958148713910263,0.26004535233450665,0.2981678795411634,0.2870859701889048,0.3272389157186637,0.22234029431577748,0.2816114310654003,0.1860774025826162,0.17750979629401217,0.12321982599125213,0.08186191257815688,0.030389859293907796,-0.0022581287892444756,-0.0059679118001461145,0.017989126825241706,0.017989126825241706,-0.03869180337201249,-0.02877691015873317,-0.05936601611051548,-0.07827547273641565,-0.1808685256696111,-0.11566742886419916,-0.11055343131208667,-0.09051491029156428];

		// X scale will fit all values from data[] within pixels 0-w
		var x = d3.scaleLinear().domain([0, data.length]).range([0, w]);
		// Y scale will fit values from 0-10 within pixels h-0 (Note the inverted domain for the y-scale: bigger is up!)
		var y = d3.scaleLinear().domain([-1, 1]).range([h, 0]);
			// automatically determining max range can work something like this
			// var y = d3.scale.linear().domain([0, d3.max(data)]).range([h, 0]);

		// create a line function that can convert data[] into x and y points
		var line = d3.line()
			// assign the X function to plot our line as we wish
			.x(function(d,i) {
				// verbose logging to show what's actually being done
				console.log('Plotting X value for data point: ' + d + ' using index: ' + i + ' to be at: ' + x(i) + ' using our xScale.');
				// return the X coordinate where we want to plot this datapoint
				return x(i);
			})
			.y(function(d) {
				// verbose logging to show what's actually being done
				console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
				return y(d);
			})

			// Add an SVG element with the desired dimensions and margin.
			var graph = d3.select("#child1").append("svg:svg")
                .attr("id","thisone")
			      .attr("width", w + m[1] + m[3])
			      .attr("height", h + m[0] + m[2])
			    .append("svg:g")
			      .attr("transform", "translate(" + m[3] + "," + m[0] + ")");
            //
			// // create yAxis
			// var xAxis = d3.axisBotto().scale(x).tickSize(-h).tickSubdivide(true);
			// // Add the x-axis.
			// graph.append("svg:g")
			//       .attr("class", "x axis")
			//       .attr("transform", "translate(0," + h + ")")
			//       .call(xAxis);


			// // create left yAxis
			// var yAxisLeft = d3.svg.axis().scale(y).ticks(4).orient("left");
			// // Add the y-axis to the left
			// graph.append("svg:g")
			//       .attr("class", "y axis")
			//       .attr("transform", "translate(-25,0)")
			//       .call(yAxisLeft);

  			// Add the line by appending an svg:path element with the data line we created above
			// do this AFTER the axes above so that the line is above the tick-lines
  			graph.append("svg:path").attr("d", line(data));

  			function updateData(data) {
  			    d3.select("#thisone").remove();
  			    var m = [80, 80, 80, 80]; // margins
		var w = document.getElementById("child1").offsetWidth - m[1] - m[3]; // width
		var h = document.getElementById("child1").offsetHeight - m[0] - m[2]; // height

                var x = d3.scaleLinear().domain([0, data.length]).range([0, w]);
		// Y scale will fit values from 0-10 within pixels h-0 (Note the inverted domain for the y-scale: bigger is up!)
		var y = d3.scaleLinear().domain([-1, 1]).range([h, 0]);
			// automatically determining max range can work something like this
			// var y = d3.scale.linear().domain([0, d3.max(data)]).range([h, 0]);

		// create a line function that can convert data[] into x and y points
		var line = d3.line()
			// assign the X function to plot our line as we wish
			.x(function(d,i) {
				// verbose logging to show what's actually being done
				console.log('Plotting X value for data point: ' + d + ' using index: ' + i + ' to be at: ' + x(i) + ' using our xScale.');
				// return the X coordinate where we want to plot this datapoint
				return x(i);
			})
			.y(function(d) {
				// verbose logging to show what's actually being done
				console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
				return y(d);
			})

			// Add an SVG element with the desired dimensions and margin.
			var graph = d3.select("#child1").append("svg:svg")
                        .attr("id","thisone")
			      .attr("width", w + m[1] + m[3])
			      .attr("height", h + m[0] + m[2])
			    .append("svg:g")
			      .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

			// create yAxis
			var xAxis = d3.axisBottom().scale(x).tickSize(-h).tickSubdivide(true);
			// Add the x-axis.
			// graph.append("svg:g")
			//       .attr("class", "x axis")
			//       .attr("transform", "translate(0," + h + ")")
			//       .call(xAxis);


			// // create left yAxis
			// var yAxisLeft = d3.svg.axis().scale(y).ticks(4).orient("left");
			// // Add the y-axis to the left
			// graph.append("svg:g")
			//       .attr("class", "y axis")
			//       .attr("transform", "translate(-25,0)")
			//       .call(yAxisLeft);

  			// Add the line by appending an svg:path element with the data line we created above
			// do this AFTER the axes above so that the line is above the tick-lines
  			graph.append("svg:path").attr("d", line(data));

            }


    </script>
</html>
